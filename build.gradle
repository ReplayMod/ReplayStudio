defaultTasks 'clean', 'build', 'shadowJar', 'install'

apply from: 'versions/preprocessor.gradle'

task setCoreVersion() {
    doLast {
        def vars = [MC: project.mcVersion as int, DEV_ENV: 1]
        if (![11202, 11201, 11200, 11102, 11100, 11002, 10904, 10800, 10710].contains(vars.MC)) {
            throw new IllegalArgumentException("Unsupported MC version $vars.MC")
        }
        project.convertTree(vars, 'src/main/java')
        project.convertTree(vars, 'src/main/resources')
        project.convertTree(vars, 'src/test/java')
        project.file('versions/core/mcVersion').write(vars.MC.toString())
    }
}

buildscript {
    repositories {
        jcenter()
        mavenCentral()
        maven {
            url 'https://oss.sonatype.org/content/groups/staging'
        }
        maven { url 'https://jitpack.io' }
    }

    dependencies {
        classpath 'io.spring.gradle:dependency-management-plugin:1.0.3.RELEASE'
        classpath 'ch.raffael.gradlePlugins.preshadow:gradle-preshadow-plugin:1.0'
        classpath 'com.github.jengelman.gradle.plugins:shadow:1.2.3'
        classpath 'nl.javadude.gradle.plugins:license-gradle-plugin:0.11.0'
        classpath 'com.github.johni0702:gradle-reproducible-builds-plugin:3dbf20d'
    }
}

subprojects {
    apply from: '../common.gradle'
}
